<!-- Reserve Modal for Available Slots -->
{% if slot.status == 'available' %}
<div class="modal fade" id="reserveModal{{ slot.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-bookmark me-2"></i>Reserve Plot {{ slot.x }},{{ slot.y }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="/reserve/{{ slot.id }}">
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Price:</strong> {{ slot.price }}<br>
                        <strong>Location:</strong> Coordinates {{ slot.x }}, {{ slot.y }}
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-12">
                            <label for="buyer_name{{ slot.id }}" class="form-label">
                                <i class="fas fa-user me-1"></i>Full Name *
                            </label>
                            <input type="text" class="form-control" id="buyer_name{{ slot.id }}" 
                                   name="buyer_name" required placeholder="Enter buyer's full name">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="buyer_email{{ slot.id }}" class="form-label">
                                <i class="fas fa-envelope me-1"></i>Email Address *
                            </label>
                            <input type="email" class="form-control" id="buyer_email{{ slot.id }}" 
                                   name="buyer_email" required placeholder="buyer@example.com">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="buyer_phone{{ slot.id }}" class="form-label">
                                <i class="fas fa-phone me-1"></i>Phone Number *
                            </label>
                            <input type="tel" class="form-control" id="buyer_phone{{ slot.id }}" 
                                   name="buyer_phone" required placeholder="+1 (555) 123-4567">
                        </div>
                    </div>
                    
                    <div class="reservation-terms mt-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="terms{{ slot.id }}" required>
                            <label class="form-check-label" for="terms{{ slot.id }}">
                                I agree to the <a href="#" class="text-primary">terms and conditions</a> 
                                and understand that this reservation is valid for 30 days.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-bookmark me-1"></i>Reserve Plot
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}

<!-- Purchase Confirmation Modal for Pending Slots -->
{% if slot.status == 'pending' %}
<div class="modal fade" id="purchaseModal{{ slot.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-check-circle me-2"></i>Complete Sale - Plot {{ slot.x }},{{ slot.y }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="/confirm_purchase/{{ slot.id }}">
                <div class="modal-body">
                    <div class="purchase-summary">
                        <div class="summary-header">
                            <h6><i class="fas fa-file-invoice-dollar me-2"></i>Purchase Summary</h6>
                        </div>
                        <div class="summary-details">
                            <div class="detail-row">
                                <span>Buyer:</span>
                                <strong>{{ slot.buyer_info.name }}</strong>
                            </div>
                            <div class="detail-row">
                                <span>Plot Location:</span>
                                <strong>{{ slot.x }}, {{ slot.y }}</strong>
                            </div>
                            <div class="detail-row">
                                <span>Reserved Date:</span>
                                <strong>{{ slot.reserved_at }}</strong>
                            </div>
                            <div class="detail-row total">
                                <span>Total Amount:</span>
                                <strong class="text-success">{{ slot.price }}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="payment-details mt-4">
                        <h6><i class="fas fa-credit-card me-2"></i>Payment Information</h6>
                        
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="payment_method{{ slot.id }}" class="form-label">Payment Method *</label>
                                <select class="form-select" id="payment_method{{ slot.id }}" name="payment_method" required>
                                    <option value="">Select payment method</option>
                                    <option value="Bank Transfer">üè¶ Bank Transfer</option>
                                    <option value="Credit Card">üí≥ Credit Card</option>
                                    <option value="Cash">üí∞ Cash Payment</option>
                                    <option value="Check">üìÑ Check</option>
                                    <option value="Digital Wallet">üì± Digital Wallet</option>
                                    <option value="Cryptocurrency">‚Çø Cryptocurrency</option>
                                </select>
                            </div>
                            
                            <div class="col-12">
                                <label for="payment_reference{{ slot.id }}" class="form-label">Payment Reference *</label>
                                <input type="text" class="form-control" id="payment_reference{{ slot.id }}" 
                                       name="payment_reference" required 
                                       placeholder="Transaction ID, check number, or reference">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check me-1"></i>Complete Sale
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}